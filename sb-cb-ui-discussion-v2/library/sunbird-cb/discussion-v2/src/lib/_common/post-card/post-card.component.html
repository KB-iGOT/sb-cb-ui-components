<div class="topLevel-card" *ngIf="post.status !== 'inactive'" [ngClass]="{'topLevel-card' : cardType=== 'topLevel',
'reply-card mb-3' : cardType=== 'reply',
'suspended': post && post.status === 'suspended'}">
    <div class="flex user-info">
        <div>
            <div class="mr-4">
                <d-v2-avatar-photo [size]="'ml'" [name]="post?.createdBy?.first_name"
                    [photoUrl]="post?.createdBy?.user_profile_img_url" [color]="
                    post?.createdBy?.first_name === loogedInUserProfile?.firstName ?
                    cardConfig?.actions?.avatarPhoto?.color || '#006400' : '#000'
                ">
                </d-v2-avatar-photo>
            </div>
        </div>

        <div class="flex flex-1 flex-col">
            <div class="flex items-center">
                <span class="mat-body-1 bold mr-1"> {{post?.createdBy?.first_name}} </span>
                <mat-icon class="icon verified mr-1"
                *ngIf="post?.createdBy?.userProfileStatus?.toLowerCase() === 'verified'"
                    i18n-aria-label aria-label="verified">check_circle</mat-icon>
            </div>
            <div class="ws-mat-black60-text mat-body-2">
                {{post?.createdBy?.designation}}
            </div>
        </div>
        <span class="mat-body-2">{{post?.createdOn | pipeRelativeTime}}</span>
        <div>
            <mat-icon class="icon" aria-hidden="false" i18n-aria-label [matMenuTriggerFor]="cardMenu"
                aria-label="more">more_vertical</mat-icon>
        </div>
    </div>
    <div class="comment mb-4 mt-2 " *ngIf="!isEditMode">
        <div class="flex mb-2">
            <div class="comment-txt mat-body-1"
                [innerHTML]="post?.title">
            </div>
        </div>
        <div class="media" *ngIf="post?.mediaUrls && post?.mediaUrls.length">
            <d-v2-image-sliders [title]="'Christy'" [imageUrls]="post?.mediaUrls" [styleData]="cardConfig?.sliderData?.styleData"></d-v2-image-sliders>
        </div>
        <div class="comment-txt mat-body-1 ws-mat-black60-text description {{post?.description.length > 152 && !post?.expanded ? 'expand' : 'un-expand'}}">
            {{post?.description}}
        </div>
        <div class="more-or-less text-right" *ngIf="post?.description.length > 152">
            <div class="cursor-pointer" (click)="viewMoreOrLess(post)"
                *ngIf="!post?.expanded">View more</div>
            <div class="cursor-pointer" (click)="viewMoreOrLess(post)"
                *ngIf="post?.expanded">View less</div>
        </div>
    </div>
    <div class="flex mt-4 tags-section">
        <ng-container *ngFor="let tag of post?.tags">
            <div class="circleBtn mr-3">
                {{tag}}
            </div>
        </ng-container>
    </div>
    <div class="my-4 h-divider"></div>
    <div class="actions" *ngIf="cardConfig?.showActions">
        <div class="flex">
            <ng-container *ngIf="cardConfig?.actions?.like?.show ">
                <div class="mr-4 circleBtn"
                    (click)="likeUnlikeComment(post)">
                    <mat-icon class="icon like-icon mr-2" aria-hidden="false" i18n-aria-label
                        [ngClass]="{'user-liked': userLikedPosts?.includes(post?.commentId)}"
                        aria-label="Fail">{{cardConfig?.actions?.like?.icon}}</mat-icon>
                    <span class="" *ngIf="cardConfig?.actions?.like?.showCount">
                        {{(post?.upVoteCount && post?.upVoteCount) || 0}}
                    </span>
                </div>
            </ng-container>
            <ng-container *ngIf="cardConfig?.actions?.comments?.show && cardType !== 'reply'">
                <div class="mr-4 cursor-pointer circleBtn" (click)="expandReplyComment()">
                    <mat-icon *ngIf="!data.replyToggle" class="icon mr-2" aria-hidden="false" i18n-aria-label
                        aria-label="Dropdown-open">arrow_drop_down</mat-icon>
                    <mat-icon *ngIf="data.replyToggle" class="icon mr-2" aria-hidden="false" i18n-aria-label
                        aria-label="Dropdown-close">arrow_drop_up</mat-icon>
                    <mat-icon class="icon mr-2" aria-hidden="false" i18n-aria-label
                        *ngIf="cardConfig?.actions?.comments?.iconDisplay"
                        aria-label="Fail">{{cardConfig?.actions?.comments?.icon}}</mat-icon>
                    <span class="" *ngIf="cardConfig?.actions?.comments?.showCount">
                        {{post?.answerPostCount && post?.answerPostCount > 1 ? 'Answers' :
                        'Answer'}} ({{(post?.answerPostCount && post?.answerPostCount) || 0}})
                    </span>
                </div>
            </ng-container>
            <ng-container
                *ngIf="cardConfig?.actions?.comments?.show && cardType === 'reply'">
                <div class="mr-4 cursor-pointer circleBtn" (click)="data.replyToggle = !data.replyToggle">
                    <mat-icon class="icon mr-2 reply-icon" aria-hidden="false" color="#1B4CA1" i18n-aria-label
                        *ngIf="cardConfig?.actions?.comments?.iconDisplay"
                        aria-label="Fail">{{cardConfig?.actions?.comments?.icon}}</mat-icon>
                    <span class="">
                        Reply
                    </span>
                </div>
            </ng-container>
        </div>
    </div>
    <ng-container *ngIf="cardConfig?.repliesSection?.show && cardType !== 'reply'">
        <div *ngIf="data.replyToggle" class="mt-4 repliesSection"
            [ngClass]="{'pl-6': cardConfig?.repliesSection?.indented}">
            <div class="mb-4">
                <d-v2-new-post [config]="cardConfig?.repliesSection?.newPostReply"
                    [type]="cardConfig?.repliesSection?.newPostReply?.type" (newComment)="newCommentEvent($event)"
                    [taggedUsers]="[post?.createdBy?.user_id]" [hierarchyPath]="[post?.discussionId]">
                </d-v2-new-post>
            </div>
            <ng-container *ngIf="replyDataCopy && replyDataCopy?.length > 0 && !loading; else noReplies">
                <ng-container *ngIf="!loading">
                    <ng-container *ngFor="let reply of fetchedReplyData">
                        <d-v2-post-card [cardType]="cardConfig?.repliesSection?.replyCardConfig?.cardType" 
                        [cardConfig]="cardConfig?.repliesSection?.replyCardConfig" [type]="cardConfig?.repliesSection?.replyCardConfig?.type"
                        [post]="reply" [replyData]="reply?.answerPosts" (likeUnlikeData)="likeUnlikeEvent($event)">
                        </d-v2-post-card>
                    </ng-container>
                </ng-container>

                <ng-container *ngIf="fetchedSearchData?.totalCount > fetchedReplyData?.length && !loadingMore">
                    <div class="load-more-comments  my-4">
                        <button mat-flat-button class="w-full underline" (click)="loadMoreAnswers()">Load
                            More</button>
                    </div>
                </ng-container>
            </ng-container>

            <ng-container *ngIf="loading || loadingMore">
                <ng-container [ngTemplateOutlet]="skeletonLoader"></ng-container>
            </ng-container>
        </div>
    </ng-container>
    <ng-container *ngIf="cardType === 'reply'">
        <div *ngIf="data.replyToggle" class="mt-4 repliesSection"
            [ngClass]="{'pl-6': cardConfig?.repliesSection?.indented}">
            <div class="mb-4">
                <d-v2-new-post [config]="cardConfig?.newPostReply"
                    [taggedUsers]="[post?.commentData?.commentSource?.userId]">
                </d-v2-new-post>
            </div>
        </div>
    </ng-container>
</div>

<ng-template #noReplies>
    <ng-container *ngIf="!loading">
        <div class="flex flex-1 items-center justify-center  justify-center">
            No comments found!
        </div>
    </ng-container>
</ng-template>

<ng-template #skeletonLoader>
    <div class="skeleton-loader mb-4">
        <div class="flex flex-col gap-4 p-4 rounded-md bg-white">

            <div class=" flex gap-4 items-center bg-white">
                <d-v2-widget-skeleton-loader [width]="'48px'" [height]="'48px'"
                    [bindingClass]="'flex rounded-full'"></d-v2-widget-skeleton-loader>
                <div class="flex flex-1 flex-col gap-2">
                    <d-v2-widget-skeleton-loader [width]="'50%'" [height]="'20px'"
                    [bindingClass]="'flex rounded'"></d-v2-widget-skeleton-loader>
                    <d-v2-widget-skeleton-loader [width]="'40%'" [height]="'18px'"
                    [bindingClass]="'flex rounded'"></d-v2-widget-skeleton-loader>
                </div>
                <d-v2-widget-skeleton-loader [width]="'64px'" [height]="'20px'"
                    [bindingClass]="'flex rounded'"></d-v2-widget-skeleton-loader>
            </div>
            <div>
                <d-v2-widget-skeleton-loader class="w-full" [width]="'100%'" [height]="'48px'"
                    [bindingClass]="'flex rounded'"></d-v2-widget-skeleton-loader>
            </div>
            <div>
                <d-v2-widget-skeleton-loader class="w-full" [width]="'100%'" [height]="'260px'"
                    [bindingClass]="'flex rounded'"></d-v2-widget-skeleton-loader>
            </div>
            <div class="flex">
                <d-v2-widget-skeleton-loader class=" mr-4" [width]="'64px'" [height]="'48px'"
                    [bindingClass]="'flex rounded-full'"></d-v2-widget-skeleton-loader>
                <d-v2-widget-skeleton-loader class=" mr-4" [width]="'64px'" [height]="'48px'"
                [bindingClass]="'flex rounded-full'"></d-v2-widget-skeleton-loader>
            </div>
        </div>
    </div>
</ng-template>

<mat-menu #cardMenu="matMenu" xPosition="after">
    <button mat-menu-item (click)="openFlagDialogue(post)"
        *ngIf="post?.createdBy?.user_id !== loogedInUserProfile?.userId">
        <mat-icon [ngStyle]="{'color': '#D13924'}">flag</mat-icon>
        <span>Flag</span>
    </button>
    <button mat-menu-item (click)="toggelEdit(post)"
        *ngIf="post?.createdBy?.user_id === loogedInUserProfile?.userId">
        <mat-icon [ngStyle]="{'color': '#1B4CA1'}">edit</mat-icon>
        <span>Edit</span>
    </button>
    <button mat-menu-item (click)="openDeleteDialogue(post)"
        *ngIf="post?.createdBy?.user_id === loogedInUserProfile?.userId">
        <mat-icon [ngStyle]="{'color': '#FF8268'}">delete</mat-icon>
        <span>Delete</span>
    </button>
</mat-menu>